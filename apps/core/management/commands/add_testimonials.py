"""
Django management команда для додавання реалістичних відгуків Speak Up.
Використання: python manage.py add_testimonials
"""
from django.core.management.base import BaseCommand
from django.utils import timezone
from datetime import timedelta
from apps.core.models import Testimonial


class Command(BaseCommand):
    help = 'Додає 12 реалістичних відгуків для різних типів курсів'

    def handle(self, *args, **options):
        # Базова дата для відгуків (останні 3 місяці)
        base_date = timezone.now() - timedelta(days=90)

        TESTIMONIALS_DATA = [
            {
                'name': 'Олена Коваленко',
                'text': 'Навчаюсь на індивідуальному курсі вже 4 місяці. Викладачі справді досвідчені, не школярі - це відчувається одразу. Платформа дуже зручна, все інтуїтивно зрозуміло. Найбільше подобається, що можна відпрацювати будь-яке пропущене заняття - це реально виручає, коли робота заважає. Прогрес відчутний, вже впевненіше спілкуюсь з клієнтами.',
                'rating': 5,
                'days_ago': 12
            },
            {
                'name': 'Максим',
                'text': 'Пішов на груповий курс після довгих пошуків нормальної школи. Тут все справді легко та зручно - не треба нікуди їхати, займаєшся з дому. Викладачі професійні, багато практики. Якщо пропустив заняття - завжди можна відпрацювати, це супер. Платформа топ, нічого не зависає. Рекомендую!',
                'rating': 5,
                'days_ago': 25
            },
            {
                'name': 'Анна Петренко',
                'text': 'Віддала сина на курс для дітей. Спочатку переживала, що онлайн не спрацює, але виявилось навпаки - йому навіть цікавіше, ніж в звичайній школі. Викладачі вміють зацікавити, не нудно. Платформа адаптована під дітей, все яскраво та зрозуміло. Якщо хворів - завжди можна відпрацювати, це дуже зручно для батьків.',
                'rating': 5,
                'days_ago': 8
            },
            {
                'name': 'Дмитро Шевченко',
                'text': 'Займаюсь бізнес-англійською для роботи. Викладачі з реальним досвідом, не просто теорія. Платформа зручна, можна займатись з будь-якого пристрою. Система відпрацювання занять - це просто спасіння для зайнятих людей. Єдине - іноді хотілось би більше інтерактивних вправ, але загалом все супер.',
                'rating': 4,
                'days_ago': 45
            },
            {
                'name': 'Катерина М.',
                'text': 'Після переїзду за кордон потрібна була англійська швидко. Обрала індивідуальні заняття - не пошкодувала. Викладачі досвідчені, знають як працювати з дорослими. Платформа топ, все працює стабільно. Можливість відпрацювати заняття - це великий плюс, бо графік не завжди дозволяє. За 3 місяці значно покращила рівень.',
                'rating': 5,
                'days_ago': 18
            },
            {
                'name': 'Олександр',
                'text': 'IT-англійська для роботи. Викладачі розуміють специфіку, не просто загальна мова. Платформа зручна, можна код показувати, ділитись екраном. Відпрацювання занять - це must have для айтішників з ненормованим графіком. Єдине - хотілось би більше технічних термінів, але загалом курс дуже корисний.',
                'rating': 4,
                'days_ago': 32
            },
            {
                'name': 'Марія Іваненко',
                'text': 'Групові заняття - це те що треба для мене. Не дорого, але якість на висоті. Викладачі справді досвідчені, не школярі як в інших школах. Платформа проста та зручна, навіть для мене як для не дуже технічної людини. Якщо пропустила - завжди можна відпрацювати, це дуже важливо. Навчання легке та зручне, не відчуваю навантаження.',
                'rating': 5,
                'days_ago': 15
            },
            {
                'name': 'Вікторія К.',
                'text': 'Дочка навчається вже півроку. Викладачі вміють працювати з дітьми, не нудно. Платформа адаптована, дітям подобається. Система відпрацювання - це спасіння, бо діти часто хворіють. Все легко та зручно, не треба нікуди везти. Єдине - іноді хотілось би більше ігор, але загалом все чудово.',
                'rating': 4,
                'days_ago': 22
            },
            {
                'name': 'Андрій Бондаренко',
                'text': 'Індивідуальні заняття для кар\'єри. Викладачі професійні, багато практики спілкування. Платформа топ, все працює без глюків. Можливість відпрацювати заняття - це реально виручає з робочим графіком. Навчання легке та зручне, не відчуваю що це обтяження. Прогрес відчутний вже за 2 місяці.',
                'rating': 5,
                'days_ago': 28
            },
            {
                'name': 'Наталія',
                'text': 'Група невелика, всі на одному рівні. Викладачі досвідчені, багато уваги кожному. Платформа зручна, не треба встановлювати нічого складного. Відпрацювання занять - це супер, бо іноді робота заважає. Все легко та зрозуміло, не відчуваю стресу від навчання. Рекомендую всім, хто хоче покращити англійську.',
                'rating': 5,
                'days_ago': 35
            },
            {
                'name': 'Сергій Мельник',
                'text': 'Бізнес-курс для переговорів. Викладачі з реальним досвідом, не просто теорія з підручників. Платформа стабільна, ніколи не було проблем. Система відпрацювання - це must have для бізнесу, бо графік непередбачуваний. Навчання легке та зручне, не відволікає від роботи. Вже використовую на практиці.',
                'rating': 5,
                'days_ago': 40
            },
            {
                'name': 'Оксана Лисенко',
                'text': 'Загалом дуже задоволена. Викладачі справді досвідчені, не школярі - це відчувається одразу в підході. Платформа топ, все інтуїтивно зрозуміло. Можливість відпрацювати будь-яке заняття - це реально зручно, особливо коли робота заважає. Навчання легке та зручне, не відчуваю навантаження. Прогрес є, це головне.',
                'rating': 5,
                'days_ago': 5
            }
        ]

        self.stdout.write('Додавання відгуків Speak Up...\n')

        created_count = 0
        skipped_count = 0

        for data in TESTIMONIALS_DATA:
            # Створюємо унікальний ключ на основі імені та тексту (перші 50 символів)
            text_preview = data['text'][:50]

            # Перевіряємо чи не існує вже такий відгук
            existing = Testimonial.objects.filter(
                name=data['name'],
                text__startswith=text_preview
            ).first()

            if existing:
                skipped_count += 1
                self.stdout.write(
                    self.style.WARNING(f'⊘ Пропущено (вже існує): {data["name"]}')
                )
                continue

            # Створюємо дату для відгуку
            created_at = base_date + timedelta(days=data['days_ago'])

            testimonial = Testimonial.objects.create(
                name=data['name'],
                text=data['text'],
                rating=data['rating'],
                is_published=True,
                created_at=created_at
            )

            created_count += 1
            self.stdout.write(
                self.style.SUCCESS(f'✓ Створено: {testimonial.name} ({testimonial.rating}★)')
            )

        self.stdout.write(
            self.style.SUCCESS(
                f'\nГотово! Створено: {created_count}, пропущено: {skipped_count}'
            )
        )
        self.stdout.write(
            f'Опублікованих відгуків: {Testimonial.objects.filter(is_published=True).count()}'
        )




